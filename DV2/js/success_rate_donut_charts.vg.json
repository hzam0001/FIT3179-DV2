{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "Eight donut charts showing Success vs Failure (1957-2020) for selected countries with clean tooltips and integer percentages",
  "background": "white",
  "config": { "view": { "stroke": "transparent" } },
  "title": {
    "text": "Mission success and failure rates from 1957 to 2020",
    "anchor": "middle",
    "fontSize": 18,
    "fontWeight": "bold",
    "offset": 20
  },
  "hconcat": [
    {
      "title": "France",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && lower(trim(datum.Country)) == 'france'" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label", "type": "nominal" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 56 },
            "text": { "field": "pct_label", "type": "nominal" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "France" } }
        }
      ]
    },

    {
      "title": "India",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && lower(trim(datum.Country)) == 'india'" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 70 },
            "text": { "field": "pct_label" },
            "color": { "value": "#111" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "India" } }
        }
      ]
    },

    {
      "title": "Japan",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && (lower(trim(datum.Country)) == 'japan' || lower(trim(datum.Country)) == 'jpn')" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 70 },
            "text": { "field": "pct_label" },
            "color": { "value": "#111" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "Japan" } }
        }
      ]
    },

    {
      "title": "USA",
      "width": 220,
      "height": 220,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && (lower(trim(datum.Country)) == 'usa' || lower(trim(datum.Country)) == 'united states' || lower(trim(datum.Country)) == 'united states of america')" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 55 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "700", "fontSize": 12 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 80 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 5", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "700", "fontSize": 14, "align": "center", "baseline": "middle", "color": "#111" },
          "encoding": { "x": { "value": 110 }, "y": { "value": 110 }, "text": { "value": "USA" } }
        }
      ]
    },

    {
      "title": "Russia",
      "width": 220,
      "height": 220,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && (lower(trim(datum.Country)) == 'russia' || lower(trim(datum.Country)) == 'soviet union' || lower(trim(datum.Country)) == 'ussr')" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 55 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "700", "fontSize": 12 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 80 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 5", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "700", "fontSize": 14, "align": "center", "baseline": "middle", "color": "#111" },
          "encoding": { "x": { "value": 110 }, "y": { "value": 110 }, "text": { "value": "Russia" } }
        }
      ]
    },

    {
      "title": "Kazakhstan",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && lower(trim(datum.Country)) == 'kazakhstan'" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 70 },
            "text": { "field": "pct_label" },
            "color": { "value": "#111" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "Kazakhstan" } }
        }
      ]
    },

    {
      "title": "China",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && lower(trim(datum.Country)) == 'china'" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 70 },
            "text": { "field": "pct_label" },
            "color": { "value": "#111" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "China" } }
        }
      ]
    },

    {
      "title": "Australia",
      "width": 140,
      "height": 140,
      "data": { "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv" },
      "transform": [
        { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
        { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
        { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 2020 && (lower(trim(datum.Country)) == 'australia' || lower(trim(datum.Country)) == 'au')" },
        { "calculate": "datum.status_norm == 'success' ? 'Success' : 'Failure'", "as": "status_group" },
        { "aggregate": [{ "op": "count", "as": "count" }], "groupby": ["status_group"] },
        { "joinaggregate": [{ "op": "sum", "field": "count", "as": "total" }] },
        { "calculate": "datum.count / datum.total * 100", "as": "pct" },
        { "calculate": "format(round(datum.pct), '.0f') + '%'", "as": "pct_label" },
        { "calculate": "format(round(datum.pct), '.0f') + '% of total missions were a ' + datum.status_group + ' (' + format(datum.count, ',') + ' missions)'", "as": "tooltip_text" }
      ],
      "layer": [
        {
          "mark": { "type": "arc", "innerRadius": 30 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative" },
            "color": {
              "field": "status_group",
              "type": "nominal",
              "scale": { "domain": ["Success", "Failure"], "range": ["#2ca02c", "#d62728"] },
              "legend": null
            },
            "tooltip": { "field": "tooltip_text", "type": "nominal", "title": null }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 42 },
            "text": { "field": "pct_label" },
            "color": { "value": "#ffffff" },
            "opacity": { "condition": { "test": "datum.pct >= 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "fontWeight": "600", "fontSize": 11 },
          "encoding": {
            "theta": { "field": "count", "type": "quantitative", "stack": "center" },
            "radius": { "value": 70 },
            "text": { "field": "pct_label" },
            "color": { "value": "#111" },
            "opacity": { "condition": { "test": "datum.pct < 8", "value": 1 }, "value": 0 }
          }
        },
        {
          "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": "600", "color": "#111" },
          "encoding": { "x": { "value": 70 }, "y": { "value": 70 }, "text": { "value": "Australia" } }
        }
      ]
    }
  ],
  "spacing": 18
}