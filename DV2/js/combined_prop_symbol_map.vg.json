{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "transparent",
  "title": {
    "text": "Missile Launches Globally",
    "color": "white",
    "fontSize": 20,
    "anchor": "middle",
    "dx": -35
  },
  "width": 1100,
  "height": 500,
  "params": [
    {
      "name": "Status_selection",
      "value": "Total launches",
      "bind": {
        "input": "select",
        "options": ["Total launches", "Success", "Failure"],
        "labels": ["Total launches", "Success", "Failure"],
        "name": "Filter by Mission Outcome: "
      }
    }
  ],
  "hconcat": [
    {
      "title": {
        "text": "1957 - 1991",
        "color": "white",
        "fontSize": 20,
        "offset": -25 
      },
      "width": 500,
      "height": 400,
      "projection": {
        "type": "equalEarth"
      },
      "layer": [
        {
          "data": {
            "sphere": true
          },
          "mark": {
            "type": "geoshape",
            "fill": "#1a1a5b"
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/world_map_with_ocean.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_admin_0_countries"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "#2d2d44",
            "stroke": "#4da6ff",
            "strokeWidth": 0.8
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/world_map_with_ocean.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_graticules_30"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": null,
            "stroke": "rgba(77, 166, 255, 0.3)",
            "strokeWidth": 0.6
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv"
          },
          "transform": [
            { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
            { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
            { "filter": "datum.YearNum >= 1957 && datum.YearNum <= 1991" },
            {
              "filter": "(Status_selection == 'Total launches') || (Status_selection == 'Success' && datum.status_norm == 'success') || (Status_selection == 'Failure' && (datum.status_norm == 'failure' || datum.status_norm == 'partial failure'))"
            },
            { "calculate": "toNumber(datum.Latitude)", "as": "lat_num" },
            { "calculate": "toNumber(datum.Longitude)", "as": "lon_num" },
            {
              "aggregate": [
                { "op": "count", "as": "mission_count" }
              ],
              "groupby": ["Country", "lat_num", "lon_num"]
            }
          ],
          "mark": {
            "type": "circle",
            "opacity": 0.75,
            "stroke": "#ffffff",
            "strokeWidth": 1.5,
            "color": "#ff6b6b"
          },
          "encoding": {
            "longitude": {
              "field": "lon_num",
              "type": "quantitative"
            },
            "latitude": {
              "field": "lat_num",
              "type": "quantitative"
            },
            "size": {
              "field": "mission_count",
              "type": "quantitative",
              "title": "Number of Missions",
              "scale": {
                "type": "sqrt",
                "domain": [1, 1400],
                "range": [1, 850],
                "nice": false
              },
              "legend": {
                "values": [10, 100, 500, 1200],
                "titleColor": "white",
                "labelColor": "white"
              }
            },
            "tooltip": [
              { "field": "Country", "type": "nominal", "title": "Country" },
              { "field": "mission_count", "type": "quantitative", "title": "Missions (1957-1991)", "format": "," }
            ]
          }
        }
      ]
    },
    {
      "title": {
        "text": "1992 - 2020",
        "color": "white",
        "fontSize": 20,
        "offset": -25
      },
      "width": 500,
      "height": 400,
      "projection": {
        "type": "equalEarth"
      },
      "layer": [
        {
          "data": {
            "sphere": true
          },
          "mark": {
            "type": "geoshape",
            "fill": "#1a1a5b"
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/world_map_with_ocean.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_admin_0_countries"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "#2d2d44",
            "stroke": "#4da6ff",
            "strokeWidth": 0.8
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/world_map_with_ocean.topojson",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_graticules_30"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": null,
            "stroke": "rgba(77, 166, 255, 0.3)",
            "strokeWidth": 0.6
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/hzam0001/FIT3179-DV2/refs/heads/main/DV2/data/total_missions.csv"
          },
          "transform": [
            { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
            { "calculate": "lower(trim(datum['Status Mission']))", "as": "status_norm" },
            { "filter": "datum.YearNum >= 1992 && datum.YearNum <= 2020" },
            {
              "filter": "(Status_selection == 'Total launches') || (Status_selection == 'Success' && datum.status_norm == 'success') || (Status_selection == 'Failure' && (datum.status_norm == 'failure' || datum.status_norm == 'partial failure'))"
            },
            { "calculate": "toNumber(datum.Latitude)", "as": "lat_num" },
            { "calculate": "toNumber(datum.Longitude)", "as": "lon_num" },
            {
              "aggregate": [
                { "op": "count", "as": "mission_count" }
              ],
              "groupby": ["Country", "lat_num", "lon_num"]
            }
          ],
          "mark": {
            "type": "circle",
            "opacity": 0.75,
            "stroke": "#ffffff",
            "strokeWidth": 1.5,
            "color": "#ff6b6b"
          },
          "encoding": {
            "longitude": {
              "field": "lon_num",
              "type": "quantitative"
            },
            "latitude": {
              "field": "lat_num",
              "type": "quantitative"
            },
            "size": {
              "field": "mission_count",
              "type": "quantitative",
              "title": "Number of Missions",
              "scale": {
                "type": "sqrt",
                "domain": [1, 1400],
                "range": [30, 1800],
                "nice": false
              },
              "legend": {
                "values": [10, 100, 500, 1200],
                "titleColor": "white",
                "labelColor": "white"
              }
            },
            "tooltip": [
              { "field": "Country", "type": "nominal", "title": "Country" },
              { "field": "mission_count", "type": "quantitative", "title": "Missions (1992-2020)", "format": "," }
            ]
          }
        }
      ]
    }
  ],
  "resolve": {
    "scale": {
      "size": "shared"
    }
  },
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "background": "transparent",
    "title": {
      "color": "white"
    },
    "legend": {
      "titleColor": "white",
      "labelColor": "white"
    }
  }
}